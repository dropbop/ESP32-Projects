/*
 * Whynter AC IR Blaster Module
 *
 * Sends IR signals to control a Whynter portable AC unit.
 * Raw timing data captured from Flipper Zero.
 *
 * Wiring:
 *   GPIO4 -> 100 ohm resistor -> IR LED anode (long leg)
 *   IR LED cathode (short leg) -> GND
 *
 * Dependencies: IRremoteESP8266 library
 */

#ifndef WHYNTER_IR_H
#define WHYNTER_IR_H

#include <IRremoteESP8266.h>
#include <IRsend.h>

#define IR_LED_PIN 4

static IRsend irSender(IR_LED_PIN);

// Whynter AC_On raw timing data (38kHz carrier, microseconds)
static const uint16_t AC_ON_RAW[] PROGMEM = {
  4384, 4450, 512, 1639, 516, 591, 486, 1641, 514, 1642, 512, 563, 514, 563, 514, 1640,
  514, 563, 514, 562, 515, 1639, 515, 564, 513, 563, 514, 1641, 514, 1641, 514, 563,
  514, 1640, 515, 563, 514, 562, 515, 562, 515, 1642, 513, 1641, 514, 1639, 516, 1638,
  516, 1640, 515, 1638, 518, 1639, 515, 1643, 565, 509, 515, 562, 515, 562, 515, 591,
  486, 562, 515, 562, 515, 562, 515, 562, 515, 1641, 514, 562, 515, 1641, 514, 563,
  514, 562, 515, 1668, 487, 1641, 514, 1641, 514, 562, 515, 1641, 567, 510, 514, 1641,
  514, 1642, 513, 5239,
  // Second burst (repeat)
  4385, 4451, 512, 1640, 515, 563, 514, 1642, 565, 1588, 514, 562, 515, 562, 515, 1640,
  515, 562, 515, 562, 515, 1640, 515, 562, 515, 562, 515, 1640, 514, 1641, 567, 509,
  515, 1638, 517, 562, 515, 563, 514, 562, 515, 1639, 516, 1640, 515, 1640, 515, 1639,
  516, 1639, 516, 1641, 514, 1640, 515, 1640, 515, 562, 515, 562, 515, 563, 514, 562,
  515, 562, 515, 562, 515, 563, 514, 563, 514, 1641, 514, 562, 515, 1638, 516, 562,
  515, 563, 514, 1640, 515, 1640, 514, 1641, 514, 591, 486, 1639, 516, 563, 567, 1588,
  514, 1668, 487, 5240,
  // Third burst
  4384, 4447, 516, 1668, 486, 1641, 514, 562, 515, 1669, 486, 563, 514, 1641, 514, 564,
  513, 1639, 516, 562, 515, 1641, 514, 1668, 487, 562, 515, 563, 514, 1640, 515, 562,
  515, 1639, 516, 563, 514, 563, 514, 1640, 515, 562, 515, 563, 568, 508, 516, 562,
  515, 562, 515, 562, 515, 562, 515, 562, 515, 562, 515, 562, 515, 562, 515, 562,
  515, 1639, 516, 562, 515, 562, 515, 562, 515, 562, 515, 562, 515, 563, 514, 563,
  514, 563, 514, 591, 486, 1639, 516, 562, 515, 1668, 487, 1640, 515, 562, 515, 1640,
  515, 1641, 514
};
static const uint16_t AC_ON_RAW_LEN = sizeof(AC_ON_RAW) / sizeof(AC_ON_RAW[0]);

// Whynter AC_Off raw timing data
static const uint16_t AC_OFF_RAW[] PROGMEM = {
  4379, 4477, 486, 1643, 512, 564, 513, 1669, 486, 1669, 486, 564, 514, 565, 512, 1639,
  569, 511, 513, 563, 514, 1641, 567, 510, 515, 565, 512, 1669, 539, 1588, 514, 591,
  486, 1640, 515, 562, 515, 1669, 486, 1641, 514, 1642, 513, 1643, 512, 564, 513, 1642,
  513, 1641, 514, 1642, 512, 564, 513, 563, 514, 564, 513, 591, 486, 1669, 486, 563,
  514, 563, 514, 1669, 486, 1641, 514, 1642, 513, 591, 486, 564, 514, 564, 513, 591,
  486, 564, 513, 591, 486, 564, 513, 563, 514, 1642, 513, 1642, 513, 1641, 514, 1641,
  514, 1640, 515, 5241,
  // Second burst
  4385, 4449, 514, 1641, 514, 563, 514, 1640, 515, 1641, 514, 563, 514, 563, 514, 1644,
  511, 563, 514, 563, 514, 1641, 514, 562, 515, 563, 514, 1641, 514, 1640, 515, 563,
  514, 1641, 514, 564, 513, 1643, 512, 1643, 512, 1642, 513, 1640, 515, 563, 514, 1642,
  514, 1639, 516, 1642, 513, 563, 514, 563, 514, 563, 514, 565, 512, 1642, 513, 563,
  567, 509, 516, 1641, 514, 1668, 486, 1642, 513, 563, 514, 563, 514, 591, 486, 565,
  512, 562, 516, 562, 515, 562, 515, 563, 514, 1641, 514, 1641, 514, 1640, 514, 1641,
  514, 1642, 513
};
static const uint16_t AC_OFF_RAW_LEN = sizeof(AC_OFF_RAW) / sizeof(AC_OFF_RAW[0]);

// Initialize IR sender
inline void irInit() {
    irSender.begin();
    Serial.println("IR sender initialized on GPIO4");
}

// Send AC ON signal
inline void irSendOn() {
    irSender.sendRaw(AC_ON_RAW, AC_ON_RAW_LEN, 38);
    Serial.println("IR: AC ON sent");
}

// Send AC OFF signal
inline void irSendOff() {
    irSender.sendRaw(AC_OFF_RAW, AC_OFF_RAW_LEN, 38);
    Serial.println("IR: AC OFF sent");
}

#endif // WHYNTER_IR_H
